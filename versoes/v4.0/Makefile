# -------------------------------------------------------------
# LICHTARA LICENSE v4 ‚Äî MAKEFILE
# Sistema de build para PDF e PDF/A
# -------------------------------------------------------------

MASTER = master-inline.md
TEMPLATE = template.tex
META = metadata.yaml
OUTPUT = lichtara-license-v4.pdf

# -------------------------------------------------------------
# Comandos principais
# -------------------------------------------------------------

pdf:
	@echo "üîß Building standard PDF..."
	pandoc $(MASTER) \
		--from markdown \
		--output=$(OUTPUT) \
		--template=$(TEMPLATE) \
		--metadata-file=$(META) \
		--pdf-engine=xelatex \
		--toc \
		--toc-depth=3
	@echo "‚úÖ PDF generated: $(OUTPUT)"

pdfa:
	@echo "üîß Building PDF/A (Zenodo-ready)..."
	pandoc $(MASTER) \
		--from markdown \
		--output=$(OUTPUT) \
		--template=$(TEMPLATE) \
		--metadata-file=$(META) \
		--pdf-engine=xelatex \
		--pdf-engine-opt=--pdfa \
		--toc \
		--toc-depth=3
	@echo "‚úÖ PDF/A generated: $(OUTPUT)"

# -------------------------------------------------------------
# Utilit√°rios
# -------------------------------------------------------------

clean:
	@echo "üßπ Cleaning files..."
	rm -f $(OUTPUT)
	@echo "üßº Clean complete."

validate:
	@echo "üîç Validating existence of required files..."
	@if [ ! -f $(MASTER) ]; then echo "‚ùå Missing $(MASTER)"; exit 1; fi
	@if [ ! -f $(TEMPLATE) ]; then echo "‚ùå Missing $(TEMPLATE)"; exit 1; fi
	@if [ ! -f $(META) ]; then echo "‚ùå Missing $(META)"; exit 1; fi
	@echo "‚úÖ All required files exist."

all: validate pdf
